<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가계부 - 거래내역 조회</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app-container">
        <div class="layout">
            <!-- 사이드바 -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <h2>거래내역 조회</h2>
                </div>
                
                <div class="menu-section">
                    <div class="menu-item active" data-menu="preview">
                        <span class="menu-title">데이터 관리</span>
                    </div>
                    <div class="menu-item" data-menu="dashboard">
                        <span class="menu-title">대시보드</span>
                    </div>
                </div>
            </nav>

            <!-- 메인 콘텐츠 -->
            <main class="main-content">
                <div class="content-container">
                    <div class="auth-bar" id="auth-bar">
                        <div class="auth-user" id="auth-user" style="display:none;"></div>
                        <button type="button" class="auth-btn" id="auth-open-btn">로그인</button>
                        <button type="button" class="auth-btn" id="auth-logout-btn" style="display:none;">로그아웃</button>
                    </div>

                    <div class="content-panel active" id="preview-content">
                        <div class="panel-header">
                            <h1>데이터 관리</h1>
                            <p class="panel-description" id="preview-provider-info"></p>
                        </div>
                        <div class="form-section">
                            <!-- 월 탭 -->
                            <div class="month-tabs" id="month-tabs">
                                <!-- JS로 1~12월 탭 생성 -->
                            </div>

                            <!-- 업로드 영역 -->
                            <div class="upload-section">
                                <div class="form-group">
                                    <label>은행/카드사 선택 <span class="required">*</span></label>
                                    <div class="bank-tabs" id="bank-tabs">
                                        <button type="button" class="bank-tab active" data-provider="TOSS">토스</button>
                                        <button type="button" class="bank-tab" data-provider="NH">농협</button>
                                        <button type="button" class="bank-tab" data-provider="KB">국민</button>
                                        <button type="button" class="bank-tab" data-provider="HYUNDAI">현대카드</button>
                                    </div>
                                </div>

                                <div class="form-group" id="pdf-password-group" style="display: none;">
                                    <label for="pdf-password-input">PDF 비밀번호 (선택)</label>
                                    <input type="password" id="pdf-password-input" placeholder="암호 PDF인 경우 입력">
                                </div>

                                <div class="upload-area" id="upload-dropzone">
                                    <p class="upload-text">파일을 여기에 드래그하거나 클릭하여 선택하세요</p>
                                    <p class="upload-hint">PDF 파일</p>
                                    <input type="file" id="upload-file-input" accept=".pdf" style="display: none;">
                                </div>
                                <div class="selected-file" id="selected-file" style="display: none;">
                                    <div class="file-info">
                                        <span class="file-name" id="selected-file-name"></span>
                                        <button type="button" class="file-remove-btn" id="file-remove-btn">×</button>
                                    </div>
                                </div>
                                <button class="execute-btn" id="upload-next-btn" disabled>파일 읽기</button>
                            </div>

                            <div id="preview-data-area" style="display: none;">
                                <div class="preview-subtitle">이용 내역</div>

                                <!-- 프리뷰 테이블 -->
                                <div class="table-wrap">
                                    <table class="preview-table" id="preview-table">
                                        <thead>
                                            <tr>
                                                <th class="sortable" data-sort-key="date">날짜</th>
                                                <th class="sortable" data-sort-key="description">내용</th>
                                                <th class="sortable" data-sort-key="amount">금액</th>
                                                <th class="sortable" data-sort-key="category">카테고리</th>
                                                <th>수정</th>
                                            </tr>
                                        </thead>
                                        <tbody id="preview-tbody"></tbody>
                                    </table>
                                </div>

                                <div class="preview-pagination" id="preview-pagination"></div>

                                <!-- 액션 버튼 -->
                                <div class="preview-actions">
                                    <button class="execute-btn" id="preview-save-btn">확정 저장</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="content-panel" id="dashboard-content">
                        <div class="panel-header">
                            <h1>대시보드</h1>
                            <p class="panel-description">확정된 데이터(confirmed=Y) 기반 월별/은행별 분석</p>
                        </div>
                        <div class="form-section">
                            <div class="dashboard-controls">
                                <label for="dashboard-year">년도</label>
                                <select id="dashboard-year"></select>

                                <label for="dashboard-provider">은행/카드사</label>
                                <select id="dashboard-provider">
                                    <option value="ALL">전체</option>
                                    <option value="TOSS">토스</option>
                                    <option value="NH">농협</option>
                                    <option value="KB">국민</option>
                                    <option value="HYUNDAI">현대카드</option>
                                </select>

                                <label for="dashboard-month">월(상세)</label>
                                <select id="dashboard-month"></select>

                                <button type="button" id="dashboard-load-btn">조회</button>
                            </div>

                            <div class="dashboard-summary" id="dashboard-summary" style="display:none;">
                                <div class="summary-card">
                                    <div class="summary-label">총수입</div>
                                    <div class="summary-value" id="dashboard-summary-income">0</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-label">총지출</div>
                                    <div class="summary-value" id="dashboard-summary-expense">0</div>
                                </div>
                                <div class="summary-card">
                                    <div class="summary-label">순이익</div>
                                    <div class="summary-value" id="dashboard-summary-balance">0</div>
                                </div>
                            </div>

                            <div class="dashboard-charts" id="dashboard-charts" style="display:none;">
                                <div class="dashboard-top-charts" id="dashboard-top-charts">
                                    <div class="chart-card">
                                        <h3 class="chart-title">월별 수입/지출 (연간)</h3>
                                        <div class="line-chart-container">
                                            <canvas id="chart-monthly-income-expense"></canvas>
                                        </div>
                                    </div>

                                    <div class="chart-card" id="chart-provider-expense-wrap" style="display:none;">
                                        <h3 class="chart-title">은행별 월별 지출 (전체 선택 시)</h3>
                                        <div class="line-chart-container">
                                            <canvas id="chart-provider-monthly-expense"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <div class="chart-card" id="chart-category-wrap">
                                    <h3 class="chart-title">카테고리별 수입/지출 (선택 월)</h3>
                                    <div class="dashboard-controls" style="margin-bottom: 10px;">
                                        <label for="dashboard-category-mode">표시</label>
                                        <select id="dashboard-category-mode">
                                            <option value="EXPENSE" selected>지출</option>
                                            <option value="INCOME">수입</option>
                                        </select>
                                    </div>
                                    <div class="donut-chart-container">
                                        <canvas id="chart-category-income-expense"></canvas>
                                    </div>
                                </div>
                            </div>

                            <div class="analytics-placeholder" id="dashboard-placeholder">
                                <p>조회 버튼을 눌러 확정된 데이터를 불러오세요.</p>
                            </div>
                        </div>
                    </div>
                 </div>
             </main>
         </div>
     </div>

    <div class="modal-overlay" id="auth-modal" style="display:none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="auth-modal-title">로그인</h3>
                <button type="button" class="modal-close" id="auth-modal-close">×</button>
            </div>

            <div class="modal-tabs">
                <button type="button" class="modal-tab active" data-tab="login" id="auth-tab-login">로그인</button>
                <button type="button" class="modal-tab" data-tab="signup" id="auth-tab-signup">회원가입</button>
            </div>

            <div class="modal-body">
                <div class="modal-panel" id="auth-panel-login">
                    <div class="modal-field">
                        <label for="auth-login-username">아이디</label>
                        <input id="auth-login-username" type="text" maxlength="50" autocomplete="username" />
                    </div>
                    <div class="modal-field">
                        <label for="auth-login-password">비밀번호</label>
                        <input id="auth-login-password" type="password" autocomplete="current-password" />
                    </div>
                    <button type="button" class="execute-btn" id="auth-login-btn">로그인</button>
                </div>

                <div class="modal-panel" id="auth-panel-signup" style="display:none;">
                    <div class="modal-field">
                        <label for="auth-signup-username">아이디</label>
                        <input id="auth-signup-username" type="text" maxlength="50" autocomplete="username" />
                    </div>
                    <div class="modal-field">
                        <label for="auth-signup-password">비밀번호</label>
                        <input id="auth-signup-password" type="password" autocomplete="new-password" />
                    </div>
                    <button type="button" class="execute-btn" id="auth-signup-btn">회원가입</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/script.js?v=20260123-10"></script>
</body>
</html>
